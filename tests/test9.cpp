#include <filesystem>

#include "../include/P452.hpp"
#include <gtest/gtest.h> // googletest header file

using std::filesystem::current_path;

inline std::string
resolvePath(const std::string& relPath)
{
  auto baseDir = std::filesystem::current_path();
  while (baseDir.has_relative_path()) {
    auto test = std::filesystem::path(relPath);
    auto combinePath = baseDir / test;
    if (std::filesystem::exists(combinePath)) {
      return combinePath.string();
    }
    baseDir = baseDir.parent_path();
  }
  throw std::runtime_error("File not found!" + relPath);
}

TEST(P452, Test9)
{
  std::string path = resolvePath("src/R-REC-P/");
  P452DigitalMaps maps = P452DigitalMaps(path);
  double Phie[101];
  double Phin[101];
  double DN[101];
  double N0[101];
  Phie[0] = 0.000000000000;
  Phie[1] = 3.600000000000;
  Phie[2] = 7.200000000000;
  Phie[3] = 10.800000000000;
  Phie[4] = 14.400000000000;
  Phie[5] = 18.000000000000;
  Phie[6] = 21.600000000000;
  Phie[7] = 25.200000000000;
  Phie[8] = 28.800000000000;
  Phie[9] = 32.400000000000;
  Phie[10] = 36.000000000000;
  Phie[11] = 39.600000000000;
  Phie[12] = 43.200000000000;
  Phie[13] = 46.800000000000;
  Phie[14] = 50.400000000000;
  Phie[15] = 54.000000000000;
  Phie[16] = 57.600000000000;
  Phie[17] = 61.200000000000;
  Phie[18] = 64.800000000000;
  Phie[19] = 68.400000000000;
  Phie[20] = 72.000000000000;
  Phie[21] = 75.600000000000;
  Phie[22] = 79.200000000000;
  Phie[23] = 82.800000000000;
  Phie[24] = 86.400000000000;
  Phie[25] = 90.000000000000;
  Phie[26] = 93.600000000000;
  Phie[27] = 97.200000000000;
  Phie[28] = 100.800000000000;
  Phie[29] = 104.400000000000;
  Phie[30] = 108.000000000000;
  Phie[31] = 111.600000000000;
  Phie[32] = 115.200000000000;
  Phie[33] = 118.800000000000;
  Phie[34] = 122.400000000000;
  Phie[35] = 126.000000000000;
  Phie[36] = 129.600000000000;
  Phie[37] = 133.200000000000;
  Phie[38] = 136.800000000000;
  Phie[39] = 140.400000000000;
  Phie[40] = 144.000000000000;
  Phie[41] = 147.600000000000;
  Phie[42] = 151.200000000000;
  Phie[43] = 154.800000000000;
  Phie[44] = 158.400000000000;
  Phie[45] = 162.000000000000;
  Phie[46] = 165.600000000000;
  Phie[47] = 169.200000000000;
  Phie[48] = 172.800000000000;
  Phie[49] = 176.400000000000;
  Phie[50] = 180.000000000000;
  Phie[51] = 183.600000000000;
  Phie[52] = 187.200000000000;
  Phie[53] = 190.800000000000;
  Phie[54] = 194.400000000000;
  Phie[55] = 198.000000000000;
  Phie[56] = 201.600000000000;
  Phie[57] = 205.200000000000;
  Phie[58] = 208.800000000000;
  Phie[59] = 212.400000000000;
  Phie[60] = 216.000000000000;
  Phie[61] = 219.600000000000;
  Phie[62] = 223.200000000000;
  Phie[63] = 226.800000000000;
  Phie[64] = 230.400000000000;
  Phie[65] = 234.000000000000;
  Phie[66] = 237.600000000000;
  Phie[67] = 241.200000000000;
  Phie[68] = 244.800000000000;
  Phie[69] = 248.400000000000;
  Phie[70] = 252.000000000000;
  Phie[71] = 255.600000000000;
  Phie[72] = 259.200000000000;
  Phie[73] = 262.800000000000;
  Phie[74] = 266.400000000000;
  Phie[75] = 270.000000000000;
  Phie[76] = 273.600000000000;
  Phie[77] = 277.200000000000;
  Phie[78] = 280.800000000000;
  Phie[79] = 284.400000000000;
  Phie[80] = 288.000000000000;
  Phie[81] = 291.600000000000;
  Phie[82] = 295.200000000000;
  Phie[83] = 298.800000000000;
  Phie[84] = 302.400000000000;
  Phie[85] = 306.000000000000;
  Phie[86] = 309.600000000000;
  Phie[87] = 313.200000000000;
  Phie[88] = 316.800000000000;
  Phie[89] = 320.400000000000;
  Phie[90] = 324.000000000000;
  Phie[91] = 327.600000000000;
  Phie[92] = 331.200000000000;
  Phie[93] = 334.800000000000;
  Phie[94] = 338.400000000000;
  Phie[95] = 342.000000000000;
  Phie[96] = 345.600000000000;
  Phie[97] = 349.200000000000;
  Phie[98] = 352.800000000000;
  Phie[99] = 356.400000000000;
  Phie[100] = 360.000000000000;
  Phin[0] = -90.000000000000;
  Phin[1] = -88.200000000000;
  Phin[2] = -86.400000000000;
  Phin[3] = -84.600000000000;
  Phin[4] = -82.800000000000;
  Phin[5] = -81.000000000000;
  Phin[6] = -79.200000000000;
  Phin[7] = -77.400000000000;
  Phin[8] = -75.600000000000;
  Phin[9] = -73.800000000000;
  Phin[10] = -72.000000000000;
  Phin[11] = -70.200000000000;
  Phin[12] = -68.400000000000;
  Phin[13] = -66.600000000000;
  Phin[14] = -64.800000000000;
  Phin[15] = -63.000000000000;
  Phin[16] = -61.200000000000;
  Phin[17] = -59.400000000000;
  Phin[18] = -57.600000000000;
  Phin[19] = -55.800000000000;
  Phin[20] = -54.000000000000;
  Phin[21] = -52.200000000000;
  Phin[22] = -50.400000000000;
  Phin[23] = -48.600000000000;
  Phin[24] = -46.800000000000;
  Phin[25] = -45.000000000000;
  Phin[26] = -43.200000000000;
  Phin[27] = -41.400000000000;
  Phin[28] = -39.600000000000;
  Phin[29] = -37.800000000000;
  Phin[30] = -36.000000000000;
  Phin[31] = -34.200000000000;
  Phin[32] = -32.400000000000;
  Phin[33] = -30.600000000000;
  Phin[34] = -28.800000000000;
  Phin[35] = -27.000000000000;
  Phin[36] = -25.200000000000;
  Phin[37] = -23.400000000000;
  Phin[38] = -21.600000000000;
  Phin[39] = -19.800000000000;
  Phin[40] = -18.000000000000;
  Phin[41] = -16.200000000000;
  Phin[42] = -14.400000000000;
  Phin[43] = -12.600000000000;
  Phin[44] = -10.800000000000;
  Phin[45] = -9.000000000000;
  Phin[46] = -7.200000000000;
  Phin[47] = -5.400000000000;
  Phin[48] = -3.600000000000;
  Phin[49] = -1.800000000000;
  Phin[50] = 0.000000000000;
  Phin[51] = 1.800000000000;
  Phin[52] = 3.600000000000;
  Phin[53] = 5.400000000000;
  Phin[54] = 7.200000000000;
  Phin[55] = 9.000000000000;
  Phin[56] = 10.800000000000;
  Phin[57] = 12.600000000000;
  Phin[58] = 14.400000000000;
  Phin[59] = 16.200000000000;
  Phin[60] = 18.000000000000;
  Phin[61] = 19.800000000000;
  Phin[62] = 21.600000000000;
  Phin[63] = 23.400000000000;
  Phin[64] = 25.200000000000;
  Phin[65] = 27.000000000000;
  Phin[66] = 28.800000000000;
  Phin[67] = 30.600000000000;
  Phin[68] = 32.400000000000;
  Phin[69] = 34.200000000000;
  Phin[70] = 36.000000000000;
  Phin[71] = 37.800000000000;
  Phin[72] = 39.600000000000;
  Phin[73] = 41.400000000000;
  Phin[74] = 43.200000000000;
  Phin[75] = 45.000000000000;
  Phin[76] = 46.800000000000;
  Phin[77] = 48.600000000000;
  Phin[78] = 50.400000000000;
  Phin[79] = 52.200000000000;
  Phin[80] = 54.000000000000;
  Phin[81] = 55.800000000000;
  Phin[82] = 57.600000000000;
  Phin[83] = 59.400000000000;
  Phin[84] = 61.200000000000;
  Phin[85] = 63.000000000000;
  Phin[86] = 64.800000000000;
  Phin[87] = 66.600000000000;
  Phin[88] = 68.400000000000;
  Phin[89] = 70.200000000000;
  Phin[90] = 72.000000000000;
  Phin[91] = 73.800000000000;
  Phin[92] = 75.600000000000;
  Phin[93] = 77.400000000000;
  Phin[94] = 79.200000000000;
  Phin[95] = 81.000000000000;
  Phin[96] = 82.800000000000;
  Phin[97] = 84.600000000000;
  Phin[98] = 86.400000000000;
  Phin[99] = 88.200000000000;
  Phin[100] = 90.000000000000;
  DN[0] = 38.450000000000;
  DN[1] = 38.468520000000;
  DN[2] = 38.368280000000;
  DN[3] = 38.148320000000;
  DN[4] = 37.803960000000;
  DN[5] = 37.328000000000;
  DN[6] = 36.718920000000;
  DN[7] = 36.046240000000;
  DN[8] = 35.455080000000;
  DN[9] = 35.116240000000;
  DN[10] = 35.085000000000;
  DN[11] = 35.297760000000;
  DN[12] = 35.226520000000;
  DN[13] = 34.893320000000;
  DN[14] = 34.581280000000;
  DN[15] = 34.310000000000;
  DN[16] = 34.113280000000;
  DN[17] = 34.006480000000;
  DN[18] = 33.987480000000;
  DN[19] = 34.038920000000;
  DN[20] = 34.243000000000;
  DN[21] = 34.835520000000;
  DN[22] = 35.873320000000;
  DN[23] = 37.103720000000;
  DN[24] = 38.344680000000;
  DN[25] = 39.535000000000;
  DN[26] = 40.675200000000;
  DN[27] = 41.767200000000;
  DN[28] = 42.761440000000;
  DN[29] = 43.521920000000;
  DN[30] = 44.121000000000;
  DN[31] = 44.397960000000;
  DN[32] = 43.775000000000;
  DN[33] = 43.269720000000;
  DN[34] = 42.680280000000;
  DN[35] = 39.999000000000;
  DN[36] = 34.793920000000;
  DN[37] = 35.386360000000;
  DN[38] = 35.952040000000;
  DN[39] = 37.905760000000;
  DN[40] = 44.807000000000;
  DN[41] = 52.075400000000;
  DN[42] = 56.517760000000;
  DN[43] = 56.913960000000;
  DN[44] = 56.979080000000;
  DN[45] = 56.914000000000;
  DN[46] = 56.938080000000;
  DN[47] = 57.632240000000;
  DN[48] = 58.742400000000;
  DN[49] = 58.963480000000;
  DN[50] = 57.695000000000;
  DN[51] = 55.964240000000;
  DN[52] = 54.370960000000;
  DN[53] = 53.021240000000;
  DN[54] = 51.880440000000;
  DN[55] = 50.872000000000;
  DN[56] = 49.965040000000;
  DN[57] = 49.290240000000;
  DN[58] = 49.539320000000;
  DN[59] = 51.183800000000;
  DN[60] = 53.648000000000;
  DN[61] = 56.431200000000;
  DN[62] = 59.311080000000;
  DN[63] = 62.142360000000;
  DN[64] = 64.777400000000;
  DN[65] = 67.029000000000;
  DN[66] = 68.369920000000;
  DN[67] = 67.634200000000;
  DN[68] = 53.762840000000;
  DN[69] = 31.196840000000;
  DN[70] = 28.422000000000;
  DN[71] = 32.058560000000;
  DN[72] = 35.265560000000;
  DN[73] = 38.071160000000;
  DN[74] = 38.840960000000;
  DN[75] = 37.949000000000;
  DN[76] = 37.011680000000;
  DN[77] = 37.316960000000;
  DN[78] = 38.081160000000;
  DN[79] = 37.871680000000;
  DN[80] = 37.459000000000;
  DN[81] = 36.939320000000;
  DN[82] = 36.569440000000;
  DN[83] = 36.593240000000;
  DN[84] = 36.948200000000;
  DN[85] = 37.475000000000;
  DN[86] = 37.991240000000;
  DN[87] = 38.371640000000;
  DN[88] = 38.631440000000;
  DN[89] = 38.905480000000;
  DN[90] = 39.245000000000;
  DN[91] = 39.589960000000;
  DN[92] = 39.913880000000;
  DN[93] = 40.079920000000;
  DN[94] = 39.782640000000;
  DN[95] = 39.401000000000;
  DN[96] = 39.336680000000;
  DN[97] = 39.540480000000;
  DN[98] = 39.900520000000;
  DN[99] = 40.315680000000;
  DN[100] = 40.726000000000;
  N0[0] = 324.058000000000;
  N0[1] = 323.623080000000;
  N0[2] = 322.689000000000;
  N0[3] = 321.301560000000;
  N0[4] = 319.501640000000;
  N0[5] = 317.333000000000;
  N0[6] = 314.843240000000;
  N0[7] = 312.213280000000;
  N0[8] = 309.655360000000;
  N0[9] = 307.375680000000;
  N0[10] = 305.415000000000;
  N0[11] = 303.788760000000;
  N0[12] = 303.136280000000;
  N0[13] = 302.827880000000;
  N0[14] = 302.181720000000;
  N0[15] = 301.812000000000;
  N0[16] = 301.862600000000;
  N0[17] = 302.260360000000;
  N0[18] = 302.957560000000;
  N0[19] = 303.938120000000;
  N0[20] = 305.320000000000;
  N0[21] = 307.512240000000;
  N0[22] = 310.565960000000;
  N0[23] = 313.980800000000;
  N0[24] = 317.407240000000;
  N0[25] = 320.702000000000;
  N0[26] = 323.763960000000;
  N0[27] = 326.525520000000;
  N0[28] = 328.927280000000;
  N0[29] = 330.789720000000;
  N0[30] = 331.991000000000;
  N0[31] = 332.390280000000;
  N0[32] = 330.877720000000;
  N0[33] = 329.333320000000;
  N0[34] = 326.483280000000;
  N0[35] = 320.297000000000;
  N0[36] = 312.840280000000;
  N0[37] = 316.246880000000;
  N0[38] = 317.621880000000;
  N0[39] = 324.918400000000;
  N0[40] = 348.097000000000;
  N0[41] = 365.247720000000;
  N0[42] = 373.478400000000;
  N0[43] = 376.514640000000;
  N0[44] = 378.642200000000;
  N0[45] = 380.512000000000;
  N0[46] = 382.274000000000;
  N0[47] = 384.151200000000;
  N0[48] = 386.041320000000;
  N0[49] = 387.308520000000;
  N0[50] = 387.123000000000;
  N0[51] = 385.512360000000;
  N0[52] = 383.189120000000;
  N0[53] = 380.533200000000;
  N0[54] = 377.701280000000;
  N0[55] = 374.728000000000;
  N0[56] = 371.548280000000;
  N0[57] = 368.178600000000;
  N0[58] = 364.981480000000;
  N0[59] = 362.337800000000;
  N0[60] = 360.044000000000;
  N0[61] = 357.880440000000;
  N0[62] = 355.737600000000;
  N0[63] = 353.489080000000;
  N0[64] = 350.974720000000;
  N0[65] = 348.012000000000;
  N0[66] = 344.367320000000;
  N0[67] = 340.543520000000;
  N0[68] = 328.933680000000;
  N0[69] = 314.375720000000;
  N0[70] = 317.750000000000;
  N0[71] = 321.023160000000;
  N0[72] = 321.780880000000;
  N0[73] = 320.859160000000;
  N0[74] = 319.992800000000;
  N0[75] = 318.973000000000;
  N0[76] = 318.100760000000;
  N0[77] = 317.824120000000;
  N0[78] = 317.534720000000;
  N0[79] = 316.724800000000;
  N0[80] = 315.960000000000;
  N0[81] = 315.430680000000;
  N0[82] = 314.766440000000;
  N0[83] = 313.814480000000;
  N0[84] = 312.812360000000;
  N0[85] = 311.939000000000;
  N0[86] = 311.587080000000;
  N0[87] = 311.750920000000;
  N0[88] = 312.093560000000;
  N0[89] = 312.435520000000;
  N0[90] = 312.796000000000;
  N0[91] = 313.252680000000;
  N0[92] = 313.801760000000;
  N0[93] = 314.335880000000;
  N0[94] = 314.646800000000;
  N0[95] = 314.888000000000;
  N0[96] = 315.308040000000;
  N0[97] = 315.849800000000;
  N0[98] = 316.403760000000;
  N0[99] = 316.880720000000;
  N0[100] = 317.248000000000;
  for (int ii = 0; ii < 101; ii++) {
    double resultDN50 = maps.GetDN50(Phie[ii], Phin[ii]);
    EXPECT_NEAR(DN[ii], resultDN50, 1e-6);
    double resultDN0 = maps.GetN050(Phie[ii], Phin[ii]);
    EXPECT_NEAR(N0[ii], resultDN0, 1e-6);
  }
}
